#!/bin/sh
set -euf
mpvc playlist >/dev/null
exec fzf \
  --ansi --no-sort --layout=reverse \
  --bind='start:reload(mpvc playlist)' \
  --bind='enter:reload(mpvc position {n}; sleep 0.1; mpvc playlist)' \
  --bind='ctrl-r:reload(mpvc playlist)' \
  --bind='ctrl-p:reload(mpvc toggle; mpvc playlist)' \
  --bind='ctrl-t:reload(mpvc remove {n}; mpvc playlist)' \
  --bind='ctrl-s:reload(mpvc seek 20; mpvc playlist)' \
  --bind='ctrl-d:reload(mpvc seek -20; mpvc playlist)' \
  --header='mpvc-fzf help: Enter:play C-r:reload C-p:toggle C-t:remove C-s:seek C-d:rewind' \
  --preview-window=up:2 \
  --preview='mpvc format "[%artist% - ]%title%%n%%pause?⏸:⏵% #%position%/%playlist-count% %time%/%duration% (%percentage%%%)%n%"'
